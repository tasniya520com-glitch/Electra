<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Electra</title>
    <style>
        :root {
            --bg-primary: #121212; --bg-secondary: #1e1e1e; --text-primary: #e0e0e0;
            --accent-primary: #8A2BE2; --accent-secondary: #4A00E0;
            --user-msg-bg: #4A00E0; --bot-msg-bg: #333333; --border-color: #444444;
        }
        body.light-mode {
            --bg-primary: #f0f2f5; --bg-secondary: #ffffff; --text-primary: #1c1c1c;
            --accent-primary: #6A1B9A; --accent-secondary: #4A148C;
            --user-msg-bg: #ede7f6; --bot-msg-bg: #f1f1f1; --border-color: #dddddd;
        }
        html, body { height: 100%; width: 100%; margin: 0; overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
        .main-container { position: relative; width: 100%; height: 100%; display: flex; }
        #sidebar { position: fixed; top: 0; left: -280px; width: 280px; height: 100%; background-color: var(--bg-primary); border-right: 1px solid var(--border-color); display: flex; flex-direction: column; transition: left 0.3s ease; z-index: 100; }
        #sidebar-header { padding: 15px; border-bottom: 1px solid var(--border-color); }
        #new-chat-btn { width: 100%; padding: 12px; background-color: var(--accent-primary); color: white; border: none; border-radius: 8px; font-size: 1em; cursor: pointer; }
        #chat-list { list-style: none; padding: 10px; margin: 0; overflow-y: auto; flex-grow: 1; }
        #chat-list li { padding: 12px 15px; border-radius: 8px; margin-bottom: 5px; cursor: pointer; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: flex; justify-content: space-between; align-items: center; }
        #chat-list li:hover { background-color: var(--bot-msg-bg); } #chat-list li.active { background-color: var(--accent-primary); color: white; }
        .delete-chat-btn { background: none; border: none; color: var(--text-secondary); cursor: pointer; opacity: 0.5; }
        .delete-chat-btn:hover { color: #f44336; opacity: 1; }
        body.sidebar-open #sidebar { left: 0; }
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 99; display: none; }
        body.sidebar-open #overlay { display: block; }
        .chat-container { width: 100%; height: 100%; display: flex; flex-direction: column; background-color: var(--bg-secondary); }
        .header { background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary)); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .header h2 { margin: 0; font-size: 1.2em; flex-grow: 1; text-align: center; }
        .header-btn { background: none; border: none; color: white; font-size: 1.5em; cursor: pointer; width: 40px; }
        .chat-box { flex-grow: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; }
        
        .message-wrapper { display: flex; align-items: flex-start; max-width: 90%; margin-bottom: 10px; }
        .user-message-wrapper { align-self: flex-end; }
        .bot-message-wrapper { align-self: flex-start; }
        /* --- FIX: ‡¶ï‡¶™‡¶ø ‡¶¨‡¶æ‡¶ü‡¶® ‡¶è‡¶¨‡¶Ç ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶†‡¶ø‡¶ï ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ --- */
        .message { position: relative; padding: 10px 15px; border-radius: 18px; line-height: 1.5; word-wrap: break-word; }
        .message p { margin: 0; user-select: text; /* ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ */ }
        .copy-btn {
            position: absolute; bottom: 5px; right: -35px; background: none; border: none;
            color: var(--text-secondary); cursor: pointer; font-size: 1.2em;
            padding: 5px; opacity: 0.5; transition: opacity 0.2s;
        }
        .message-wrapper:hover .copy-btn { opacity: 1; }
        .user-message { background-color: var(--user-msg-bg); color: var(--text-primary); }
        body.dark-mode .user-message { color: white; }
        .bot-message { background-color: var(--bot-msg-bg); border: 1px solid var(--border-color); }
        
        .chat-input-container { padding: 8px; background-color: var(--bg-secondary); border-top: 1px solid var(--border-color); flex-shrink: 0; }
        .input-area { display: flex; align-items: flex-end; gap: 8px; }
        #user-input { flex-grow: 1; min-width: 0; padding: 10px 18px; border: 1px solid var(--border-color); background-color: var(--bg-primary); color: var(--text-primary); border-radius: 20px; font-size: 1em; resize: none; overflow-y: hidden; max-height: 120px; line-height: 1.4; }
        .icon-btn { background: none; border: none; color: var(--text-secondary); font-size: 1.5em; cursor: pointer; padding: 5px; flex-shrink: 0; margin-bottom: 2px; }
        #send-btn { background-color: var(--accent-primary); color: white; border-radius: 50%; width: 48px; height: 48px; font-size: 1.5em; }
        #preview-container { position: relative; margin-bottom: 8px; text-align: center; }
        #image-preview { max-width: 80px; max-height: 80px; border-radius: 8px; }
        #close-preview { position: absolute; top: -5px; right: calc(50% - 50px); background: #333; color: white; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; }
        @media (min-width: 768px) { #sidebar { position: static; left: 0; } #menu-toggle, #overlay { display: none !important; } }
    </style>
</head>
<body class="dark-mode">
    <div class="main-container">
        <nav id="sidebar"><div id="sidebar-header"><button id="new-chat-btn">+ New Chat</button></div><ul id="chat-list"></ul></nav>
        <div id="overlay"></div>
        <div class="chat-container">
            <div class="header"><button id="menu-toggle" class="header-btn">‚ò∞</button><h2>Electra</h2><button id="theme-toggle" class="header-btn">‚òÄÔ∏è</button></div>
            <div id="chat-box" class="chat-box"></div>
            <div class="chat-input-container">
                <div id="preview-container"></div>
                <div class="input-area">
                    <input type="file" id="image-upload-input" accept="image/*" style="display: none;"><button class="icon-btn" id="image-upload-btn" title="‡¶õ‡¶¨‡¶ø ‡¶™‡¶æ‡¶†‡¶æ‡¶®">üìé</button>
                    <textarea id="user-input" placeholder="‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®..." rows="1"></textarea><button class="icon-btn" id="send-btn" title="‡¶™‡¶æ‡¶†‡¶æ‡¶®">‚û§</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const chatBox = document.getElementById('chat-box'), userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn'), body = document.body;
        const themeToggleBtn = document.getElementById('theme-toggle'), newChatBtn = document.getElementById('new-chat-btn');
        const sidebar = document.getElementById('sidebar'), chatList = document.getElementById('chat-list');
        const menuToggle = document.getElementById('menu-toggle'), overlay = document.getElementById('overlay');
        const imageUploadInput = document.getElementById('image-upload-input'), imageUploadBtn = document.getElementById('image-upload-btn'), previewContainer = document.getElementById('preview-container');
        
        // =========================================================================
        // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ API KEY ‡¶ü‡¶ø ‡¶è‡¶ñ‡¶æ‡¶®‡ßá "" ‡¶è‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞‡ßá ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
        // =========================================================================
        const storedApiKey = "AIzaSyC-lSq933H_CLpAwvWgRsMTmrnO4t9DuAw"; 
        // =========================================================================
        
        let allChats = { conversations: {}, activeChatId: null }, uploadedImage = { base64: null, mimeType: null };
        const STORAGE_KEY = 'electraAllChats';

        function saveChats() { localStorage.setItem(STORAGE_KEY, JSON.stringify(allChats)); }
        function loadChats() { const savedData = localStorage.getItem(STORAGE_KEY); if (savedData) { allChats = JSON.parse(savedData); if (!allChats.activeChatId || !allChats.conversations[allChats.activeChatId]) startNewChat(); } else startNewChat(); renderSidebar(); loadChat(allChats.activeChatId); }
        function renderSidebar() { chatList.innerHTML = ''; Object.values(allChats.conversations).sort((a,b) => b.id.localeCompare(a.id)).forEach(chat => { const li = document.createElement('li'); li.textContent = chat.title; li.dataset.chatId = chat.id; if (chat.id === allChats.activeChatId) li.classList.add('active'); const deleteBtn = document.createElement('button'); deleteBtn.className = 'delete-chat-btn'; deleteBtn.innerHTML = 'üóëÔ∏è'; deleteBtn.onclick = (e) => { e.stopPropagation(); deleteChat(chat.id); }; li.appendChild(deleteBtn); li.onclick = () => { loadChat(chat.id); body.classList.remove('sidebar-open'); }; chatList.appendChild(li); }); }
        function loadChat(chatId) { allChats.activeChatId = chatId; const chat = allChats.conversations[chatId]; chatBox.innerHTML = ''; if (chat.history.length === 0) { appendMessage("‡¶π‡ßç‡¶Ø‡¶æ‡¶≤‡ßã! ‡¶Ü‡¶Æ‡¶ø Electra‡•§ ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶ú‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶∏‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§‡¶Ö‡¶•‡¶¨‡¶æ Whatsapp ‡¶¨‡¶æ Facebook ‡¶≤‡¶ø‡¶ñ‡ßá ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ", 'bot-message', false); } else { chat.history.forEach(msg => { const text = msg.parts.find(p => p.text)?.text || (msg.role === 'user' && msg.parts.length > 0 ? 'Image' : ''); const className = msg.role === 'user' ? 'user-message' : 'bot-message'; appendMessage(text, className, false); }); } renderSidebar(); saveChats(); }
        function startNewChat() { const newChatId = `chat_${Date.now()}`; allChats.conversations[newChatId] = { id: newChatId, title: 'New Chat', history: [] }; allChats.activeChatId = newChatId; loadChat(newChatId); }
        function deleteChat(chatId) { if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶è‡¶á ‡¶Ü‡¶≤‡ßã‡¶ö‡¶®‡¶æ‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) { delete allChats.conversations[chatId]; if (allChats.activeChatId === chatId) { const remainingIds = Object.keys(allChats.conversations); if (remainingIds.length > 0) loadChat(remainingIds[0]); else startNewChat(); } renderSidebar(); saveChats(); } }

        newChatBtn.addEventListener('click', () => { startNewChat(); body.classList.remove('sidebar-open'); });
        menuToggle.addEventListener('click', () => body.classList.toggle('sidebar-open'));
        overlay.addEventListener('click', () => body.classList.remove('sidebar-open'));
        document.addEventListener('DOMContentLoaded', loadChats);
        function applyTheme(theme) { body.className = theme + '-mode'; themeToggleBtn.textContent = (theme === 'light') ? 'üåú' : '‚òÄ'; }
        themeToggleBtn.addEventListener('click', () => { const newTheme = body.classList.contains('light-mode') ? 'dark' : 'light'; applyTheme(newTheme); localStorage.setItem('theme', newTheme); });
        applyTheme(localStorage.getItem('theme') || 'dark');
        imageUploadBtn.addEventListener('click', () => imageUploadInput.click());
        imageUploadInput.addEventListener('change', (e) => { const file = e.target.files[0]; if (!file) return; const reader = new FileReader(); reader.readAsDataURL(file); reader.onloadend = () => { uploadedImage = { base64: reader.result.split(',')[1], mimeType: file.type }; previewContainer.innerHTML = `<img src="${reader.result}" id="image-preview" alt="Preview"/><button id="close-preview">√ó</button>`; document.getElementById('close-preview').addEventListener('click', clearPreview); }; });
        function clearPreview() { uploadedImage = { base64: null, mimeType: null }; previewContainer.innerHTML = ''; imageUploadInput.value = ''; }

        const sendMessage = async () => {
            if (!storedApiKey) { return alert("API Key ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡¶®‡¶ø‡•§"); }
            const messageText = userInput.value.trim();
            if (messageText === "" && !uploadedImage.base64) return;
            const activeChat = allChats.conversations[allChats.activeChatId];
            
            appendMessage(messageText, 'user-message');
            
            const lowerCaseMessage = messageText.toLowerCase();
            // --- FIX: ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá ---
            if (lowerCaseMessage === 'facebook' || lowerCaseMessage === 'whatsapp') {
                const title = lowerCaseMessage === 'facebook' ? "Admin Facebook Profile:" : "Admin WhatsApp Channel:";
                const url = lowerCaseMessage === 'facebook' ? "https://www.facebook.com/m.tasniyatania" : "https://whatsapp.com/channel/0029VaYOKD7Gk1FnVrxOLQ0I";
                const linkHTML = `${title}<br><a href="${url}" target="_blank">${url}</a>`;
                appendMessage(linkHTML, 'bot-message', false);
                userInput.value = ""; userInput.style.height = 'auto';
                return;
            }
            
            if (activeChat.history.length === 0 && messageText) { activeChat.title = messageText.substring(0, 30) + (messageText.length > 30 ? '...' : ''); renderSidebar(); }
            
            userInput.value = ""; userInput.style.height = 'auto'; showLoadingIndicator();
            const parts = [];
            if (uploadedImage.base64) parts.push({ inline_data: { mime_type: uploadedImage.mimeType, data: uploadedImage.base64 } });
            if (messageText) parts.push({ text: messageText });
            activeChat.history.push({ role: 'user', parts: parts });
            clearPreview(); saveChats();
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${storedApiKey}`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: activeChat.history }) });
                removeLoadingIndicator();
                if (!response.ok) throw new Error((await response.json()).error.message || 'API ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ');
                const data = await response.json();
                const botResponse = data.candidates?.[0]?.content?.parts?.[0]?.text;
                if (botResponse) appendMessage(botResponse, 'bot-message');
                else appendMessage("AI ‡¶ï‡ßã‡¶®‡ßã ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡ßá‡ßü‡¶®‡¶ø‡•§", 'bot-message error-message');
            } catch (error) { removeLoadingIndicator(); appendMessage(`‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: ${error.message}`, 'bot-message error-message'); }
        };
        
        function appendMessage(text, className, addToHistory = true) {
            if (!text && className === 'user-message' && !uploadedImage.base64) return;
            const wrapper = document.createElement('div'); wrapper.className = `${className}-wrapper`;
            const messageDiv = document.createElement('div'); messageDiv.className = `message ${className}`;
            const p = document.createElement('p'); p.innerHTML = text ? text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>') : (className === 'user-message' && uploadedImage.base64 ? '<i>Image sent</i>' : '');
            
            const copyBtn = document.createElement('button'); copyBtn.className = 'copy-btn'; copyBtn.textContent = 'üìã';
            copyBtn.onclick = () => copyMessageText(copyBtn);

            wrapper.appendChild(messageDiv);
            wrapper.appendChild(copyBtn);
            messageDiv.appendChild(p);

            chatBox.appendChild(wrapper); chatBox.scrollTop = chatBox.scrollHeight;
            if (addToHistory && className === 'bot-message') { allChats.conversations[allChats.activeChatId].history.push({ role: 'model', parts: [{ text }] }); saveChats(); }
        }
        
        function copyMessageText(btn) { navigator.clipboard.writeText(btn.closest('.message-wrapper').querySelector('p').innerText).then(() => { btn.textContent = '‚úÖ'; setTimeout(() => { btn.textContent = 'üìã'; }, 1500); }); }
        function showLoadingIndicator() { const wrapper = document.createElement('div'); wrapper.id = 'loading'; wrapper.className = 'bot-message-wrapper'; const loadingDiv = document.createElement('div'); loadingDiv.className = 'message loading-message'; loadingDiv.innerHTML = `<p>Electra ‡¶ö‡¶ø‡¶®‡ßç‡¶§‡¶æ ‡¶ï‡¶∞‡¶õ‡ßá...</p>`; wrapper.appendChild(loadingDiv); chatBox.appendChild(wrapper); chatBox.scrollTop = chatBox.scrollHeight; }
        function removeLoadingIndicator() { const loadingWrapper = document.getElementById('loading'); if (loadingWrapper) loadingWrapper.remove(); }
        
        sendBtn.addEventListener('click', sendMessage);
        
        // --- FIX: Enter ‡¶ï‡ßÄ ‡¶è‡¶ñ‡¶® ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡¶æ‡¶á‡¶® ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶¨‡ßá ---
        userInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && e.shiftKey) { // Shift+Enter ‡¶ö‡¶æ‡¶™‡¶≤‡ßá ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶∂‡¶∞‡ßç‡¶ü‡¶ï‡¶æ‡¶ü
                e.preventDefault();
                sendMessage();
            }
            // ‡¶∂‡ßÅ‡¶ß‡ßÅ Enter ‡¶ö‡¶æ‡¶™‡¶≤‡ßá ‡¶ï‡¶ø‡¶õ‡ßÅ‡¶á ‡¶π‡¶¨‡ßá ‡¶®‡¶æ, textarea ‡¶∏‡ßç‡¶¨‡¶æ‡¶≠‡¶æ‡¶¨‡¶ø‡¶ï ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá
        });
        
        userInput.addEventListener('input', () => { userInput.style.height = 'auto'; userInput.style.height = (userInput.scrollHeight) + 'px'; });
    </script>
</body>
</html>